language: python

# See here: http://docs.shippable.com/en/latest/config.html#caching-minions
# Add [reset_minion] to the commit message to reset the minion.
cache: true

python:
    - 2.7

# This doesn't work yet on shippable but we keep it here in case it does.
virtualenv:
    system_site_packages: true

env:
    - ZOLTAN=$HOME/zoltan

before_install:
    # System dependencies via apt.
    - sudo apt-get install build-essential python-dev libopenmpi-dev
    - sudo apt-get install cython python-numpy python-mako python-mpi4py python-nose
    # Build zoltan.
    - ./build_zoltan.sh $HOME/zoltan

install:
    # This hack gets system_site_packages working.
    - rm $VIRTUAL_ENV/lib/python2.7/no-global-site-packages.txt
    # We need a recent version of Cython.
    - pip install --upgrade cython
    # Build pysph.
    - make clean
    - python setup.py develop

before_script:
    - rm -rf ~/.pysph/source
    - mkdir -p shippable/testresults

script:
    - nosetests -v -A slow --with-xunit --xunit-file=shippable/testresults/nosetests.xml
