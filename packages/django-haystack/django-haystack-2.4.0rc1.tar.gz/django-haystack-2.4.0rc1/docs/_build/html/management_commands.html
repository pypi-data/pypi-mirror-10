<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Management Commands &mdash; Haystack 2.1.1-dev documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.1.1-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Haystack 2.1.1-dev documentation" href="toc.html" />
    <link rel="next" title="Architecture Overview" href="architecture_overview.html" />
    <link rel="prev" title="Template Tags" href="templatetags.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="architecture_overview.html" title="Architecture Overview"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="templatetags.html" title="Template Tags"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="toc.html">Haystack 2.1.1-dev documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="management-commands">
<span id="ref-management-commands"></span><h1>Management Commands<a class="headerlink" href="#management-commands" title="Permalink to this headline">¶</a></h1>
<p>Haystack comes with several management commands to make working with Haystack
easier.</p>
<div class="section" id="clear-index">
<h2><code class="docutils literal"><span class="pre">clear_index</span></code><a class="headerlink" href="#clear-index" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">clear_index</span></code> command wipes out your entire search index. Use with
caution. In addition to the standard management command options, it accepts the
following arguments:</p>
<div class="highlight-python"><div class="highlight"><pre>``--noinput``:
    If provided, the interactive prompts are skipped and the index is
    uncerimoniously wiped out.
``--verbosity``:
    Accepted but ignored.
``--using``:
    If provided, determines which connection should be used. Default is
    ``default``.
``--nocommit``:
    If provided, it will pass commit=False to the backend.  This means that the
    update will not become immediately visible and will depend on another explicit commit
    or the backend&#39;s commit strategy to complete the update.
</pre></div>
</div>
<p>By default, this is an <strong>INTERACTIVE</strong> command and assumes that you do <strong>NOT</strong>
wish to delete the entire index.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">--nocommit</span></code> argument is only supported by the Solr backend.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Depending on the backend you&#8217;re using, this may simply delete the entire
directory, so be sure your <code class="docutils literal"><span class="pre">HAYSTACK_CONNECTIONS[&lt;alias&gt;]['PATH']</span></code> setting is correctly
pointed at just the index directory.</p>
</div>
</div>
<div class="section" id="update-index">
<h2><code class="docutils literal"><span class="pre">update_index</span></code><a class="headerlink" href="#update-index" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you use the <code class="docutils literal"><span class="pre">--start/--end</span></code> flags on this command, you&#8217;ll need to
install <a class="reference external" href="http://pypi.python.org/pypi/python-dateutil/1.5">dateutil</a> to handle the datetime parsing.</p>
</div>
<p>The <code class="docutils literal"><span class="pre">update_index</span></code> command will freshen all of the content in your index. It
iterates through all indexed models and updates the records in the index. In
addition to the standard management command options, it accepts the following
arguments:</p>
<div class="highlight-python"><div class="highlight"><pre>``--age``:
    Number of hours back to consider objects new. Useful for nightly
    reindexes (``--age=24``). Requires ``SearchIndexes`` to implement
    the ``get_updated_field`` method. Default is ``None``.
``--start``:
    The start date for indexing within. Can be any dateutil-parsable string,
    recommended to be YYYY-MM-DDTHH:MM:SS. Requires ``SearchIndexes`` to
    implement the ``get_updated_field`` method. Default is ``None``.
``--end``:
    The end date for indexing within. Can be any dateutil-parsable string,
    recommended to be YYYY-MM-DDTHH:MM:SS. Requires ``SearchIndexes`` to
    implement the ``get_updated_field`` method. Default is ``None``.
``--batch-size``:
    Number of items to index at once. Default is 1000.
``--remove``:
    Remove objects from the index that are no longer present in the
    database.
``--workers``:
    Allows for the use multiple workers to parallelize indexing. Requires
    ``multiprocessing``.
``--verbosity``:
    If provided, dumps out more information about what&#39;s being done.

      * ``0`` = No output
      * ``1`` = Minimal output describing what models were indexed
        and how many records.
      * ``2`` = Full output, including everything from ``1`` plus output
        on each batch that is indexed, which is useful when debugging.
``--using``:
    If provided, determines which connection should be used. Default is
    ``default``.
``--nocommit``:
    If provided, it will pass commit=False to the backend.  This means that the
    updates will not become immediately visible and will depend on another explicit commit
    or the backend&#39;s commit strategy to complete the update.
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">--nocommit</span></code> argument is only supported by the Solr and Elasticsearch backends.</p>
</div>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre># Update everything.
./manage.py update_index --settings=settings.prod

# Update everything with lots of information about what&#39;s going on.
./manage.py update_index --settings=settings.prod --verbosity=2

# Update everything, cleaning up after deleted models.
./manage.py update_index --remove --settings=settings.prod

# Update everything changed in the last 2 hours.
./manage.py update_index --age=2 --settings=settings.prod

# Update everything between Dec. 1, 2011 &amp; Dec 31, 2011
./manage.py update_index --start=&#39;2011-12-01T00:00:00&#39; --end=&#39;2011-12-31T23:59:59&#39; --settings=settings.prod

# Update just a couple apps.
./manage.py update_index blog auth comments --settings=settings.prod

# Update just a single model (in a complex app).
./manage.py update_index auth.User --settings=settings.prod

# Crazy Go-Nuts University
./manage.py update_index events.Event media news.Story --start=&#39;2011-01-01T00:00:00 --remove --using=hotbackup --workers=12 --verbosity=2 --settings=settings.prod
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This command <em>ONLY</em> updates records in the index. It does <em>NOT</em> handle
deletions unless the <code class="docutils literal"><span class="pre">--remove</span></code> flag is provided. You might consider
a queue consumer if the memory requirements for <code class="docutils literal"><span class="pre">--remove</span></code> don&#8217;t
fit your needs. Alternatively, you can use the
<code class="docutils literal"><span class="pre">RealtimeSignalProcessor</span></code>, which will automatically handle deletions.</p>
</div>
</div>
<div class="section" id="rebuild-index">
<h2><code class="docutils literal"><span class="pre">rebuild_index</span></code><a class="headerlink" href="#rebuild-index" title="Permalink to this headline">¶</a></h2>
<p>A shortcut for <code class="docutils literal"><span class="pre">clear_index</span></code> followed by <code class="docutils literal"><span class="pre">update_index</span></code>. It accepts any/all
of the arguments of the following arguments:</p>
<div class="highlight-python"><div class="highlight"><pre>``--age``:
    Number of hours back to consider objects new. Useful for nightly
    reindexes (``--age=24``). Requires ``SearchIndexes`` to implement
    the ``get_updated_field`` method.
``--batch-size``:
    Number of items to index at once. Default is 1000.
``--site``:
    The site object to use when reindexing (like `search_sites.mysite`).
``--noinput``:
    If provided, the interactive prompts are skipped and the index is
    uncerimoniously wiped out.
``--remove``:
    Remove objects from the index that are no longer present in the
    database.
``--verbosity``:
    If provided, dumps out more information about what&#39;s being done.

      * ``0`` = No output
      * ``1`` = Minimal output describing what models were indexed
        and how many records.
      * ``2`` = Full output, including everything from ``1`` plus output
        on each batch that is indexed, which is useful when debugging.
``--using``:
    If provided, determines which connection should be used. Default is
    ``default``.
``--nocommit``:
    If provided, it will pass commit=False to the backend.  This means that the
    update will not become immediately visible and will depend on another explicit commit
    or the backend&#39;s commit strategy to complete the update.
</pre></div>
</div>
<p>For when you really, really want a completely rebuilt index.</p>
</div>
<div class="section" id="build-solr-schema">
<h2><code class="docutils literal"><span class="pre">build_solr_schema</span></code><a class="headerlink" href="#build-solr-schema" title="Permalink to this headline">¶</a></h2>
<p>Once all of your <code class="docutils literal"><span class="pre">SearchIndex</span></code> classes are in place, this command can be used
to generate the XML schema Solr needs to handle the search data. It accepts the
following arguments:</p>
<div class="highlight-python"><div class="highlight"><pre>``--filename``:
    If provided, directs output to a file instead of stdout.
``--using``:
    If provided, determines which connection should be used. Default is
    ``default``.
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command does NOT update the <code class="docutils literal"><span class="pre">schema.xml</span></code> file for you. You either
have to specify a <code class="docutils literal"><span class="pre">filename</span></code> flag or have to
copy-paste (or redirect) the output to the correct file. Haystack has no
way of knowing where your Solr is setup (or if it&#8217;s even on the same
machine), hence the manual step.</p>
</div>
</div>
<div class="section" id="haystack-info">
<h2><code class="docutils literal"><span class="pre">haystack_info</span></code><a class="headerlink" href="#haystack-info" title="Permalink to this headline">¶</a></h2>
<p>Provides some basic information about how Haystack is setup and what models it
is handling. It accepts no arguments. Useful when debugging or when using
Haystack-enabled third-party apps.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="toc.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Management Commands</a><ul>
<li><a class="reference internal" href="#clear-index"><code class="docutils literal"><span class="pre">clear_index</span></code></a></li>
<li><a class="reference internal" href="#update-index"><code class="docutils literal"><span class="pre">update_index</span></code></a></li>
<li><a class="reference internal" href="#rebuild-index"><code class="docutils literal"><span class="pre">rebuild_index</span></code></a></li>
<li><a class="reference internal" href="#build-solr-schema"><code class="docutils literal"><span class="pre">build_solr_schema</span></code></a></li>
<li><a class="reference internal" href="#haystack-info"><code class="docutils literal"><span class="pre">haystack_info</span></code></a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="templatetags.html"
                        title="previous chapter">Template Tags</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="architecture_overview.html"
                        title="next chapter">Architecture Overview</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/management_commands.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2009-2013, Daniel Lindsley.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.4</a>
      
      |
      <a href="_sources/management_commands.txt"
          rel="nofollow">Page source</a></li>
    </div>

    

    
  </body>
</html>