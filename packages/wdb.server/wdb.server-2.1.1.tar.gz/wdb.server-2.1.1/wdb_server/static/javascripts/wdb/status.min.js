/*! wdb           2015-05-07 */

(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=function(){function a(){this.debug=$("body").attr("data-debug")||!1}return a.prototype.time=function(){var a;return a=new Date,a.getHours()+":"+a.getMinutes()+":"+(a.getSeconds()+"."+a.getMilliseconds())},a.prototype.log=function(){var a,b;return this.debug?(b="["+this.constructor.name+"] ("+this.time()+")",a=[b].concat(Array.prototype.slice.call(arguments,0)),console.log.apply(console,a)):void 0},a.prototype.fail=function(){var a,b;return b=this.constructor.name,a=[b].concat(Array.prototype.slice.call(arguments,0)),console.error.apply(console,a)},a}(),l=null,k=25,g=function(a,b){var c;return(c=$(".sessions tr[data-uuid="+a+"]")).size()||(c=$('<tr data-uuid="'+a+'"> <td class="uuid"><a href="/debug/session/'+a+'">'+a+'</a></td> <td class="socket">No</td> <td class="websocket">No</td> <td class="close"> <a class="fa fa-times-circle remove" title="Force close"></a> </td>'),$(".sessions tbody").append(c)),c.find("."+b).text("Yes")},j=function(a,b){var c;if((c=$(".sessions tr[data-uuid="+a+"]")).size())return"socket"===b&&"No"===c.find(".websocket").text()||"websocket"===b&&"No"===c.find(".socket").text()?c.remove():c.find("."+b).text("No")},d=function(a){var b,c,d,e,f;for(e="<tr>",f=["fn","lno","cond","fun"],c=0,d=f.length;d>c;c++)b=f[c],e+='<td class="'+b+'">'+(a[b]||"∅")+"</td>";return e+='<td class="action"> <a class="fa fa-folder-open open" title="Open"></a> <a class="fa fa-minus-circle remove" title="Remove"></a> </td>',e+="</tr>",$(".breakpoints tbody").append($(e))},i=function(a){var b,c,d,e,f,g,h,i,j,k,l;for(h=$(".breakpoints tr"),j=[],d=0,f=h.length;f>d;d++){for(l=h[d],b=$(l),k=!0,i=["fn","lno","cond","fun"],e=0,g=i.length;g>e;e++)c=i[e],k=k&&b.find("."+c).text()===""+(a[c]||"∅");j.push(k?b.remove():void 0)}return j},c=function(a,b){var c,d,e,f,g,h,i;if(i=a[b],null==i)return"∅";if("time"===b)h=function(a){var b,c;return c=Math.floor((new Date-a)/1e3),b=Math.floor(c/31536e3),b>1?b+"y":(b=Math.floor(c/2592e3),b>1?b+"mo":(b=Math.floor(c/86400),b>1?b+"d":(b=Math.floor(c/3600),b>1?b+"h":(b=Math.floor(c/60),b>1?b+"m":Math.floor(c)+"s"))))},i=h(1e3*i);else if("mem"===b||"cpu"===b)i=i.toFixed(2)+"%";else if("cmd"===b){for(f=[],g=i.split(" "),c=0,d=g.length;d>c;c++)e=g[c],f.push(0===e.indexOf("/")?'<abbr title="'+e+'">'+e.split("/").slice(-1)+"</abbr>":1===e.indexOf(":")&&2===e.indexOf("\\")?'<abbr title="'+e+'"> '+e.slice(3).split("\\").slice(-1)+"</abbr>":e);i=f.join(" ")}return i},e=function(a){var b,d,e,f,g,h,i,j,k,l;if((b=$(".processes tbody tr[data-pid="+a.pid+"]")).size()){for(j=["pid","user","cmd","time","mem","cpu"],l=[],e=0,g=j.length;g>e;e++)d=j[e],l.push(b.find("."+d).html(c(a,d)));return l}for(i='<tr data-pid="'+a.pid+'" '+(a.threadof?'data-threadof="'+a.threadof+'"':"")+">",k=["pid","user","cmd","time","mem","cpu"],f=0,h=k.length;h>f;f++)d=k[f],i+='<td class="rowspan '+d+'"> '+c(a,d)+"</td>";return i+='<td class="action"><a href="" class="fa fa-minus minus" title="Toggle threads"></a></td>',i+='<td class="action">',i+='<a href="" class="fa fa-pause pause" title="Pause"></a> ',i+="</td>",i+="</tr>",$(".processes tbody").append($(i))},f=function(a){var b,d,e,f,g,h,i,j,k;if(d=$(".processes tbody tr[data-pid="+a.of+"]"),d.size()){if((e=$(".processes tbody tr[data-tid="+a.id+"]")).size()){for(j=["id","of"],k=[],g=0,h=j.length;h>g;g++)f=j[g],k.push(e.find("."+f).text(c(a,f)));return k}return i='<tr data-tid="'+a.id+'" data-of="'+a.of+'">',i+='<td class="id">'+c(a,"id")+"</td>",i+='<td class="action">',i+='<a href="" class="fa fa-pause pause" title="Pause"></a> ',i+="</td>",i+="</tr>",b=d.nextAll("[data-pid]"),b.size()?b.before(i):$(".processes tbody").append(i),d.find(".rowspan").attr("rowspan",(+d.find(".rowspan").attr("rowspan")||1)+1)}},m=function(a){var b,c,h,m,o,p,q,r,s,t,u,v,w,x,y,z,A;switch(k=25,s=a.data,t=s.indexOf("|"),t>-1?(h=s.substr(0,t),m=JSON.parse(s.substr(t+1))):(h=s,m=""),h){case"AddWebSocket":return g(m,"websocket");case"AddSocket":return g(m,"socket");case"RemoveWebSocket":return j(m,"websocket");case"RemoveSocket":return j(m,"socket");case"AddBreak":return d(m);case"RemoveBreak":return i(m);case"AddProcess":return e(m);case"AddThread":return f(m);case"KeepProcess":for(u=$(".processes tbody tr[data-pid]"),y=[],o=0,q=u.length;q>o;o++)A=u[o],c=$(A),v=parseInt(c.attr("data-pid")),n.call(m,v)<0?($(".processes [data-of="+c.attr("data-pid")+"]").remove(),y.push(c.remove())):y.push(void 0);return y;case"KeepProcess":for(w=$(".processes tbody tr[data-tid]"),z=[],p=0,r=w.length;r>p;p++)A=w[p],c=$(A),x=parseInt(c.attr("data-tid")),n.call(m,x)<0?(c.remove(),b=$(".processes [data-pid="+c.attr("data-of")+"]"),z.push(b.attr("rowspan",+b.attr("rowspan")-1))):z.push(void 0);return z;case"StartLoop":return setInterval(function(){return l.send("ListProcesses")},2e3)}},b=function(){return l=new WebSocket("ws://"+location.host+"/status"),l.onopen=function(){return console.log("WebSocket open",arguments),$("tbody tr").remove(),l.send("ListSockets"),l.send("ListWebSockets"),l.send("ListBreaks"),l.send("ListProcesses")},l.onerror=function(){return console.log("WebSocket error",arguments)},l.onmessage=m,l.onclose=function(){return console.log("WebSocket closed",arguments),k*=2,setTimeout(b,k)}},h=function(a){return"∅"===a?null:a},$(function(){return b(),$(".sessions tbody").on("click",".remove",function(a){return l.send("RemoveUUID|"+$(this).closest("tr").attr("data-uuid")),!1}),$(".breakpoints tbody").on("click",".open",function(a){var b;return b=$(this).closest("tr"),l.send("RunFile|"+b.find(".fn").text()),!1}),$(".breakpoints tbody").on("click",".remove",function(a){var b,c;return b=$(this).closest("tr"),c={fn:b.find(".fn").text(),lno:parseInt(b.find(".lno").text()),cond:h(b.find(".cond").text()),fun:h(b.find(".fun").text())},l.send("RemoveBreak|"+JSON.stringify(c)),!1}),$(".processes tbody").on("click",".pause",function(a){var b;return b=$(this).closest("tr"),l.send("Pause|"+(b.attr("data-pid")||b.attr("data-tid"))),!1}).on("click",".minus",function(a){var b,c;return b=$(this),c=b.closest("tr"),$("[data-of="+c.attr("data-pid")+"]").hide(),c.find(".rowspan").attr("rowspan",1),b.attr("class",b.attr("class").replace(/minus/g,"plus")),!1}).on("click",".plus",function(a){var b,c,d;return b=$(this),c=b.closest("tr"),d=$("[data-of="+c.attr("data-pid")+"]").show().size(),c.find(".rowspan").attr("rowspan",d+1),b.attr("class",b.attr("class").replace(/plus/g,"minus")),!1}),$(".runfile").on("submit",function(){return l.send("RunFile|"+$(this).find("[type=text]").val()),!1})})}).call(this);
//# sourceMappingURL=status.min.js.map