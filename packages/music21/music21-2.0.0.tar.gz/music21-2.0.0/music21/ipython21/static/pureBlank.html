<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>IPython Notebook</title>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full&delayStartupUntil=configured" charset="utf-8"></script>
    <script type="text/javascript">
        // MathJax disabled, set as null to distingish from *missing* MathJax,
        // where it will be undefined, and should prompt a dialog later.
        window.mathjax_url = "http://cdn.mathjax.org/mathjax/latest/MathJax.js";
    </script>

    <link rel="stylesheet" href="/static/components/bootstrap-tour/build/css/bootstrap-tour.min.css" type="text/css" />
    <link rel="stylesheet" href="/static/components/codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="/static/style/style.min.css" type="text/css"/>
    <link rel="stylesheet" href="/static/notebook/css/override.css" type="text/css" />
    <link rel="stylesheet" href="/static/custom/custom.css" type="text/css" />

<script src="/static/components/requirejs/require.js" type="text/javascript" charset="utf-8"></script>
    <script>
      require.config({
          baseUrl: '/static/',
          paths: {
            nbextensions : '/nbextensions',
            underscore : '/static/components/underscore/underscore-min.js',
            backbone : '/static/components/backbone/backbone-min.js',
          },
          shim: {
            underscore: {
              exports: '_'
            },
            backbone: {
              deps: ["underscore", "jquery"],
              exports: "Backbone"
            },
          }
      });
    </script>
</head>
<body 
    data-project=""
    data-base-url="/"
    data-notebook-name="zz_blank.ipynb"
    data-notebook-path=""
    class="notebook_app"
>

<noscript>
    <div id='noscript'>
      IPython Notebook requires JavaScript.<br>
      Please enable it to proceed.
  </div>
</noscript>

<div id="site">
    <div id="ipython-main-app">
        <div id="notebook_panel">
            <div id="notebook"></div>
            <div id="pager_splitter"></div>
            <div id="pager">
                <div id='pager_button_area'></div>
                <div id="pager-container" class="container"></div>
            </div>
        </div>
    </div>
    <div id='tooltip' class='ipython_tooltip' style='display:none'></div>
</div>

<script src="/static/components/jquery/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/components/jquery-ui/ui/minified/jquery-ui.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/components/bootstrap/bootstrap/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/base/js/namespace.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/base/js/page.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/auth/js/loginwidget.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/components/google-caja/html-css-sanitizer-minified.js" charset="utf-8"></script>
<script src="/static/components/codemirror/lib/codemirror.js" charset="utf-8"></script>
<script type="text/javascript">
    CodeMirror.modeURL = "/static/components/codemirror/mode/%N/%N.js";
</script>
<script src="/static/components/codemirror/addon/mode/loadmode.js" charset="utf-8"></script>
<script src="/static/components/codemirror/addon/mode/multiplex.js" charset="utf-8"></script>
<script src="/static/components/codemirror/addon/mode/overlay.js" charset="utf-8"></script>
<script src="/static/components/codemirror/addon/edit/matchbrackets.js" charset="utf-8"></script>
<script src="/static/components/codemirror/addon/edit/closebrackets.js" charset="utf-8"></script>
<script src="/static/components/codemirror/addon/comment/comment.js" charset="utf-8"></script>
<script src="/static/components/codemirror/mode/htmlmixed/htmlmixed.js" charset="utf-8"></script>
<script src="/static/components/codemirror/mode/xml/xml.js" charset="utf-8"></script>
<script src="/static/components/codemirror/mode/javascript/javascript.js" charset="utf-8"></script>
<script src="/static/components/codemirror/mode/css/css.js" charset="utf-8"></script>
<script src="/static/components/codemirror/mode/rst/rst.js" charset="utf-8"></script>
<script src="/static/components/codemirror/mode/markdown/markdown.js" charset="utf-8"></script>
<script src="/static/components/codemirror/mode/gfm/gfm.js" charset="utf-8"></script>
<script src="/static/components/codemirror/mode/python/python.js" charset="utf-8"></script>
<script src="/static/notebook/js/codemirror-ipython.js" charset="utf-8"></script>
<script src="/static/components/highlight.js/build/highlight.pack.js" charset="utf-8"></script>
<script src="/static/dateformat/date.format.js" charset="utf-8"></script>
<script src="/static/base/js/events.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/base/js/utils.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/base/js/keyboard.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/base/js/security.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/base/js/dialog.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/services/kernels/js/kernel.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/services/kernels/js/comm.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/services/sessions/js/session.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/layoutmanager.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/mathjaxutils.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/outputarea.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/cell.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/celltoolbar.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/codecell.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/completer.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/textcell.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/savewidget.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/quickhelp.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/pager.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/menubar.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/toolbar.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/maintoolbar.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/notebook.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/keyboardmanager.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/notificationwidget.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/notificationarea.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/tooltip.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/tour.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/config.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/contexthint.js" charset="utf-8"></script>
<script src="/static/notebook/js/celltoolbarpresets/default.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/celltoolbarpresets/rawcell.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/notebook/js/celltoolbarpresets/slideshow.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/custom/custom.js" type="text/javascript" charset="utf-8"></script>


<!-- MSC from here on... -->
<script>
require(['notebook/js/main', 'services/kernels/js/kernel', 'notebook/js/notebook', 
         'widgets/js/init','base/js/utils',
         'components/bootstrap-tour/build/js/bootstrap-tour.min'], 
              function() {
	getData = function (data) {
        console.log('data', data);
    };
    handle_output = function (out){
        // thanks to
        // http://jakevdp.github.io/blog/2013/06/01/ipython-notebook-javascript-python-communication/
        var res = null;

        // if output is a print statement
        if(out.msg_type == "stream"){
           res = out.content.data;
        }
        // if output is a python object
        else if(out.msg_type === "pyout"){
           res = out.content.data["text/plain"];
        }
        // if output is a python error
        else if (out.msg_type == "pyerr"){
           res = out.content.ename + ": " + out.content.evalue;
        }
        // if output is something we haven't thought of
        else {
           res = "[out type not implemented]";  
        }
        return res;
    };
   
    exec_code = function (messagedCodeInput, outputCallback){
   	    console.log('exec_code', messagedCodeInput);
   	    var kernel = IPython.notebook.kernel;
        if (outputCallback === undefined) {
       	  outputCallback = getData;
        }
        var callbacks = {};
        if (parseInt(IPython.version.slice(0,1)) < 2) {
            callbacks = {'output' : function (out) { var data = handle_output(out); 
                        outputCallback(data);
               } 
            };
        } else {
            callbacks = { 'iopub' : {'output' : function (out) { var data = handle_output(out); 
                                 outputCallback(data);
                                    } 
                        } 
            };
            
        }
        var msg_id = kernel.execute(messagedCodeInput, callbacks, {silent:false});
    };
    waitForKernel = function () {
   		if (IPython.notebook.kernel !== null && IPython.notebook.kernel.execute !== null) {
            console.log('all loaded...waiting 500 more ms');
   			setTimeout(startLocal, 500, true);
   		} else {
   		    console.log('still waiting');
   			setTimeout(waitForKernel, 100, true);
   		}
    };
    changePython = function () {
        var val = this.value; // HTMLInput
        exec_code(val, function(data) { $('#pyOutput').text(data); });
    }
    startLocal = function () {
   	    $(document).add('*').off();
   	    exec_code('import random');
		var $main = $("<div id='pyjsMain'>" + 
		    "Put python code to run here: (danger: can affect local filesystem)<br/></div>");
	    $main.css('font-size', '40px').css('margin','20px 20px 20px 20px').css('line-height', '50px');
   	    var $pi = $("<input type='text' id='pythonIn' size='120' style='width: 300px' value='random.randint(25, 30)'/>");
   	    $pi.change(changePython);
   	    $main.append($pi);
   	    $main.append("<div id='pyOutput'>Output goes here</div>");
   	    $main.append("<div style='font-size: 12px'>I already called 'import random' to save time. Note that if you assign a variable, it will stick, even across reloads.</div>")
        $('body').prepend($main);
   	    IPython.notebook.notebook_name = newTitle + '.ABCDE';
   	    IPython.save_widget.update_document_title();
    };
    console.log('about to wait...');   
    var newTitle = "Python to Javascript Mapping via IPython Notebook";  // title keeps returning    
    waitForKernel();
});

</script>
<style>
div#notebook { display: none; }
div#ipython-main-app { display: none; }
</style>
</body>

</html>