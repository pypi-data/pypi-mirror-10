{% extends 'base.html' %}

{% load i18n %}
{% load static %}
{% load hitcount_tags %}
{% load forum_filter %}
{% load photo %}

{% block extra_js %}
<script src="{% static 'js/hitcount/django-hitcount.js' %}"></script>
<script type="text/javascript">
    $('[data-toggle="tooltip"]').tooltip();
</script>
<script src="{% static 'js/js/forum.js' %}"></script>
{% endblock %}

{% block content %}

<div class="container">

	{% if user.id %}
		{% include "musette/notification.html" %}
	{% endif %}

	{% get_hit_count for forum as total_hits %}

	{% if forum.moderators_id == user.id %}
		{% if forum.is_moderate %}
			{% if forum|get_tot_topics_moderate > 0 %}
				<div class="alert alert-success" role="alert">
					<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
					<p>{% trans "The forum "%} {{forum.name}} {% trans "is pending moderations" %}</p>
				</div>
			{% endif %}
		{% endif %}
	{% endif %}

	<h5>{{forum.description|safe}}</h5>
    <a href="/newtopic/{{forum.name}}/" class="btn btn-success btn-xs"><i class="glyphicon glyphicon-plus"></i> {% trans "New topic" %}</a>

	<div class="panel panel-default">
		<div class="panel-heading" style="height: 2.8em">
			<p>{% trans "Forum" %}: {{forum.name}}
				{% if total_hits|add:"0" > 1 %}
					<span style="font-size: 0.8em">({% trans "This forum has" %} {{ total_hits }} {% trans "views" %})</span>
				{% else %}
					<span style="font-size: 0.8em">({% trans "This forum has" %} {{ total_hits }} {% trans "view" %})</span>
				{% endif %}
			</p>
		</div>
	  	<div class="panel-body">
    		<div class="table-responsive">
				<table class="table table-striped">
				    <thead>
				      <tr>
				      	<th>#</th>
				        <th>{% trans "Title" %}</th>
				        <th>{% trans "User" %}</th>
				    	<th>{% trans "Responses" %}</th>
				    	<th>{% trans "Views" %}</th>
				        <th>{% trans "Date" %}</th>
				      </tr>
				    </thead>
				    <tbody>
				    	{% for topic in topics %}
				    		{% if topic.moderate %}
							    <tr>
							    	<td><i class="glyphicon glyphicon-comment"</i></td>
							        <td style="max-width: 25.0em">
							        	<a href="/topic/{{forum.name}}/{{topic.slug}}/{{topic.idtopic}}/"
							        	data-toggle="tooltip" data-placement="bottom" title="{% trans 'Views' %}: {% get_tot_views topic.idtopic %}">
							        	{{topic.title}}
							        	</a>
							        	<p>{{ topic.description|safe|truncatechars:300 }}</p>
							    	</td>
							        <td>
							        	<img src="{{topic.user.id|get_photo}}" class='img-circle' width="30", height="30" />
							        	<p>{{topic.user.username|get_path_profile|safe}}</p>
							        </td>
							        <td>{{topic.idtopic|get_tot_comments}}</td>
							        <td>{% get_tot_views topic.idtopic %}</td>
							        <td>{{topic.date}}</td>
							    </tr>
						    {% endif %}
					    {% endfor %}
				    </tbody>
				</table>
			</div>

			<div class="pull-left">
				<b>{% trans "Topics" %}: {{forum.topics_count}}</b>
				{% if forum.is_moderate %}
					{% if forum|get_tot_topics_moderate > 0 %}
						<b> ({% trans "Missing for moderate" %}: {{forum|get_tot_topics_moderate}})</b>
					{% endif %}
				{% endif %}
				<br>
				<p>{% trans "Created" %}: {{forum.date}}</p>

			</div>

			<ul class="pager" style="float: right">
	            {% if paginator.has_prev %}
	            <li><a href="/forum/{{forum.name}}/?page={{ paginator.firstPage }}"> << </a></li>
	            <li><a href="/forum/{{forum.name}}/?page={{ paginator.prev_page }}"> < </a></li>
	            {% else %}
	            <li class="previous disabled"><a> << </a></li>
	            <li class="previous disabled"><a> < </a></li>
	            {% endif %}
	            {% if paginator.has_next %}
	            <li><a href="/forum/{{forum.name}}/?page={{ paginator.next_page }}"> > </a></li>
	            <li><a href="/forum/{{forum.name}}/?page={{ paginator.pages }}"> >> </a></li>
	            {% else %}
	            <li class="previous disabled"><a> > </a></li>
	            <li class="previous disabled"><a> >> </a></li>
	            {% endif %}
		        <p>{% trans "Page" %} <{{paginator.page}} {% trans "of" %} {{paginator.pages}}> </p>
		    </ul>
	  	</div>
	</div>

</div>

{% endblock %}

{% block hitcount_javascript %}
{% insert_hit_count_js_variables for forum %}
{% endblock %}